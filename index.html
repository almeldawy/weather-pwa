<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weather Premium</title>

<meta name="theme-color" content="#38bdf8">

<style>
/* üé® THEMES */
:root {
  --bg: linear-gradient(135deg, #bae6fd, #ffffff);
  --card: rgba(255,255,255,0.75);
  --text: #0f172a;
}

body.dark {
  --bg: linear-gradient(135deg, #020617, #020617);
  --card: rgba(15,23,42,0.75);
  --text: #f8fafc;
}

body.sunny { --bg: linear-gradient(135deg,#fde68a,#fef3c7); }
body.rainy { --bg: linear-gradient(135deg,#94a3b8,#e2e8f0); }
body.snowy { --bg: linear-gradient(135deg,#e0f2fe,#f8fafc); }

* {
  box-sizing: border-box;
  font-family: system-ui, -apple-system;
}

body {
  margin: 0;
  min-height: 100vh;
  background: var(--bg);
  color: var(--text);
  display: flex;
  justify-content: center;
  align-items: center;
  transition: background 0.8s;
}

.app {
  width: 100%;
  max-width: 420px;
  padding: 20px;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

button {
  border: none;
  background: var(--card);
  backdrop-filter: blur(14px);
  border-radius: 14px;
  padding: 10px 14px;
  font-size: 18px;
  cursor: pointer;
}

.card {
  margin-top: 24px;
  padding: 30px;
  border-radius: 26px;
  background: var(--card);
  backdrop-filter: blur(18px);
  box-shadow: 0 30px 60px rgba(0,0,0,0.15);
  text-align: center;
}

.temp {
  font-size: 64px;
  font-weight: 700;
}

.icon {
  font-size: 48px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}

.forecast {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
  font-size: 14px;
}
</style>
</head>

<body>
<main class="app">
<header>
  <h1 id="city">Localisation‚Ä¶</h1>
  <button id="theme">üåô</button>
</header>

<section class="card">
  <div class="icon" id="icon">‚õÖ</div>
  <div class="temp"><span id="temp">--</span>¬∞C</div>
  <p id="desc">---</p>

  <div class="forecast" id="forecast"></div>
</section>
</main>

<script>
// üåô THEME
if (localStorage.theme === "dark") document.body.classList.add("dark");
document.getElementById("theme").onclick = () => {
  document.body.classList.toggle("dark");
  localStorage.theme =
    document.body.classList.contains("dark") ? "dark" : "light";
};

// üå¶Ô∏è METEO CODES
const codes = {
  0: ["‚òÄÔ∏è","Ciel d√©gag√©","sunny"],
  1: ["üå§Ô∏è","Peu nuageux","sunny"],
  2: ["‚õÖ","Nuages","sunny"],
  3: ["‚òÅÔ∏è","Couvert","rainy"],
  61:["üåßÔ∏è","Pluie","rainy"],
  71:["‚ùÑÔ∏è","Neige","snowy"],
  80:["üå¶Ô∏è","Averses","rainy"],
  95:["‚õàÔ∏è","Orage","rainy"]
};

// üìç GEO + METEO
navigator.geolocation.getCurrentPosition(async pos => {
  const { latitude, longitude } = pos.coords;

  // üåç Ville (OpenStreetMap)
  const geo = await fetch(
    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`
  ).then(r=>r.json());
  document.getElementById("city").textContent =
    geo.address.city || geo.address.town || "Votre position";

  // ‚òÅÔ∏è M√©t√©o
  const data = await fetch(
    `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&hourly=temperature_2m&timezone=auto`
  ).then(r=>r.json());

  const w = data.current_weather;
  const [icon,text,theme] = codes[w.weathercode] || ["‚ùî","Inconnu",""];
  document.getElementById("icon").textContent = icon;
  document.getElementById("temp").textContent = Math.round(w.temperature);
  document.getElementById("desc").textContent = text;
  document.body.classList.add(theme);

  // ‚è±Ô∏è Pr√©visions horaires (3h)
  const hours = data.hourly.temperature_2m.slice(1,4);
  document.getElementById("forecast").innerHTML =
    hours.map((t,i)=>`<div>+${(i+1)*3}h<br>${Math.round(t)}¬∞</div>`).join("");
});

// ‚öôÔ∏è SERVICE WORKER
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>
