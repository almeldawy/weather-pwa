<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weather Premium</title>

<!-- Manifest PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#38bdf8">
<link rel="icon" type="image/png" href="icons/icon-192.png">

<style>
/* THEMES */
:root {
  --bg: linear-gradient(135deg, #bae6fd, #ffffff);
  --card: rgba(255,255,255,0.75);
  --text: #0f172a;
}
body.dark {
  --bg: linear-gradient(135deg, #020617, #0f172a);
  --card: rgba(15,23,42,0.75);
  --text: #f8fafc;
}
body.sunny { --bg: linear-gradient(135deg,#fde68a,#fef3c7); }
body.rainy { --bg: linear-gradient(135deg,#94a3b8,#e2e8f0); }
body.snowy { --bg: linear-gradient(135deg,#e0f2fe,#f8fafc); }
body.cloudy { --bg: linear-gradient(135deg,#cbd5e1,#f1f5f9); }

/* GLOBAL STYLES */
* { box-sizing: border-box; font-family: system-ui, -apple-system; }
body { margin:0; min-height:100vh; background: var(--bg); color: var(--text);
      display:flex; justify-content:center; align-items:center; transition: background 0.8s;}
.app { width:100%; max-width:420px; padding:20px; }
header { display:flex; justify-content:space-between; align-items:center; }
button { border:none; background: var(--card); backdrop-filter:blur(14px);
         border-radius:14px; padding:10px 14px; font-size:18px; cursor:pointer; }
.card { margin-top:24px; padding:30px; border-radius:26px;
        background: var(--card); backdrop-filter: blur(18px);
        box-shadow:0 30px 60px rgba(0,0,0,0.15); text-align:center; }
.temp { font-size:64px; font-weight:700; }
.icon { font-size:48px; animation: float 3s ease-in-out infinite; }
@keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-6px);} }
.forecast { display:flex; justify-content:space-between; margin-top:20px; font-size:14px; }
.daily { margin-top:20px; text-align:center; font-size:14px; }
.daily div { margin-bottom:6px; }
</style>
</head>

<body>
<main class="app">
<header>
  <h1 id="city">Localisation‚Ä¶</h1>
  <button id="theme">üåô</button>
</header>

<section class="card">
  <div class="icon" id="icon">‚õÖ</div>
  <div class="temp"><span id="temp">--</span>¬∞C</div>
  <p id="desc">---</p>

  <div class="forecast" id="forecast"></div>
  <div class="daily" id="daily"></div>
</section>
</main>

<script>
// THEME
if(localStorage.theme==='dark') document.body.classList.add('dark');
document.getElementById('theme').onclick = ()=>{
  document.body.classList.toggle('dark');
  localStorage.theme=document.body.classList.contains('dark')?'dark':'light';
};

// WEATHER CODES
const codes={
  0:["‚òÄÔ∏è","Ciel d√©gag√©","sunny"],
  1:["üå§Ô∏è","Peu nuageux","sunny"],
  2:["‚õÖ","Nuages","cloudy"],
  3:["‚òÅÔ∏è","Couvert","cloudy"],
  45:["üå´Ô∏è","Brouillard","cloudy"],
  48:["üå´Ô∏è‚ùÑÔ∏è","Brouillard givrant","snowy"],
  51:["üå¶Ô∏è","Bruine","rainy"],
  61:["üåßÔ∏è","Pluie","rainy"],
  63:["üåßÔ∏è","Pluie mod√©r√©e","rainy"],
  65:["üåßÔ∏èüíß","Pluie forte","rainy"],
  71:["‚ùÑÔ∏è","Neige","snowy"],
  73:["‚ùÑÔ∏è","Neige mod√©r√©e","snowy"],
  75:["‚ùÑÔ∏èüíß","Neige forte","snowy"],
  80:["üå¶Ô∏è","Averses","rainy"],
  81:["üåßÔ∏è","Averses mod√©r√©es","rainy"],
  82:["üåßÔ∏èüíß","Averses fortes","rainy"],
  95:["‚õàÔ∏è","Orage","rainy"]
};

// GEO + WEATHER
navigator.geolocation.getCurrentPosition(async pos=>{
  const {latitude,longitude}=pos.coords;

  // CITY via OpenStreetMap
  const geo=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`).then(r=>r.json());
  document.getElementById('city').textContent=geo.address.city||geo.address.town||geo.address.village||"Votre position";

  // CURRENT + HOURLY + DAILY WEATHER
  const data=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&hourly=temperature_2m&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`).then(r=>r.json());

  // CURRENT
  const w=data.current_weather;
  const [icon,text,theme]=codes[w.weathercode]||["‚ùî","Inconnu","cloudy"];
  document.getElementById('icon').textContent=icon;
  document.getElementById('temp').textContent=Math.round(w.temperature);
  document.getElementById('desc').textContent=text;
  document.body.classList.add(theme);

  // HOURLY FORECAST 3H
  const hours=data.hourly.temperature_2m.slice(1,4);
  document.getElementById('forecast').innerHTML=hours.map((t,i)=>`<div>+${(i+1)*3}h<br>${Math.round(t)}¬∞</div>`).join("");

  // DAILY FORECAST 7 DAYS
  const days=data.daily.weathercode.slice(0,7);
  const maxs=data.daily.temperature_2m_max.slice(0,7);
  const mins=data.daily.temperature_2m_min.slice(0,7);
  document.getElementById('daily').innerHTML=days.map((c,i)=>{
    const [ic,desc]=codes[c]||["‚ùî","Inconnu"];
    return `<div>${ic} ${desc}: ${Math.round(maxs[i])}¬∞ / ${Math.round(mins[i])}¬∞</div>`;
  }).join("");
});

// SERVICE WORKER
if('serviceWorker' in navigator){navigator.serviceWorker.register('service-worker.js');}
</script>
</body>
</html>
