<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weather Today Premium</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Manifest PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#38bdf8">
<link rel="icon" type="image/png" href="icons/icon-192.png">

<style>
:root {
  --bg: #bae6fd;
  --card: rgba(255,255,255,0.25);
  --text: #0f172a;
}
body.dark { --bg:#0f172a; --card:rgba(15,23,42,0.4); --text:#f8fafc; }
*{box-sizing:border-box;font-family:'Poppins',sans-serif;margin:0;}
body{min-height:100vh; display:flex; justify-content:center; align-items:center; background:var(--bg); color:var(--text); transition:background 0.8s; overflow:hidden;}
.app{width:100%; max-width:440px; padding:20px; z-index:1; position:relative;}
header{display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;}
button{border:none; background: var(--card); backdrop-filter:blur(12px); border-radius:14px; padding:10px 14px; font-size:18px; cursor:pointer; transition: transform 0.2s;}
button:hover{transform:scale(1.05);}
.card{padding:40px; border-radius:28px; background: var(--card); backdrop-filter:blur(18px); box-shadow:0 20px 50px rgba(0,0,0,0.15); text-align:center; transition:all 0.5s; position:relative; z-index:1;}
.temp{font-size:70px; font-weight:700; margin:15px 0;}
.icon{font-size:80px; animation: float 3s ease-in-out infinite;}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-8px);}}
.forecast{display:flex; overflow-x:auto; margin-top:25px; padding-bottom:10px;}
.forecast div{background: rgba(255,255,255,0.1); padding:10px 12px; border-radius:12px; margin-right:8px; min-width:55px; text-align:center; font-size:14px;}
::-webkit-scrollbar{height:6px;}
::-webkit-scrollbar-thumb{background: rgba(0,0,0,0.2); border-radius:3px;}
canvas{position:absolute; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events:none;}
</style>
</head>
<body>
<canvas id="weatherCanvas"></canvas>
<main class="app">
<header>
  <h1 id="city">Localisation‚Ä¶</h1>
  <button id="theme">üåô</button>
</header>

<section class="card">
  <div class="icon" id="icon">‚õÖ</div>
  <div class="temp"><span id="temp">--</span>¬∞C</div>
  <p id="desc">---</p>

  <div class="forecast" id="forecast"></div>
</section>
</main>

<script>
// THEME
if(localStorage.theme==='dark') document.body.classList.add('dark');
document.getElementById('theme').onclick = ()=>{
  document.body.classList.toggle('dark');
  localStorage.theme=document.body.classList.contains('dark')?'dark':'light';
};

// WEATHER CODES
const codes={
0:["‚òÄÔ∏è","Ciel d√©gag√©","sunny"],
1:["üå§Ô∏è","Peu nuageux","sunny"],
2:["‚õÖ","Nuages","cloudy"],
3:["‚òÅÔ∏è","Couvert","cloudy"],
45:["üå´Ô∏è","Brouillard","cloudy"],
48:["üå´Ô∏è‚ùÑÔ∏è","Brouillard givrant","snowy"],
51:["üå¶Ô∏è","Bruine","rainy"],
61:["üåßÔ∏è","Pluie","rainy"],
63:["üåßÔ∏è","Pluie mod√©r√©e","rainy"],
65:["üåßÔ∏èüíß","Pluie forte","rainy"],
71:["‚ùÑÔ∏è","Neige","snowy"],
73:["‚ùÑÔ∏è","Neige mod√©r√©e","snowy"],
75:["‚ùÑÔ∏èüíß","Neige forte","snowy"],
80:["üå¶Ô∏è","Averses","rainy"],
81:["üåßÔ∏è","Averses mod√©r√©es","rainy"],
82:["üåßÔ∏èüíß","Averses fortes","rainy"],
95:["‚õàÔ∏è","Orage","rainy"]
};

// GEO + WEATHER
navigator.geolocation.getCurrentPosition(async pos=>{
  const {latitude,longitude}=pos.coords;

  // CITY
  const geo=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`).then(r=>r.json());
  document.getElementById('city').textContent=geo.address.city||geo.address.town||geo.address.village||"Votre position";

  // CURRENT + HOURLY TODAY
  const data=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&hourly=temperature_2m,weathercode&timezone=auto`).then(r=>r.json());

  const w=data.current_weather;
  const [icon,text,theme]=codes[w.weathercode]||["‚ùî","Inconnu","cloudy"];
  document.getElementById('icon').textContent=icon;
  document.getElementById('temp').textContent=Math.round(w.temperature);
  document.getElementById('desc').textContent=text;
  document.body.classList.add(theme);

  // HOURLY FORECAST TODAY
  const hours=data.hourly.time.map(t=>new Date(t).getHours());
  const temps=data.hourly.temperature_2m;
  const codes_h=data.hourly.weathercode;
  let html='';
  for(let i=0;i<hours.length;i++){
    if(i>=24) break;
    const [ic,desc]=codes[codes_h[i]]||["‚ùî","Inconnu"];
    html+=`<div>${hours[i]}h<br>${Math.round(temps[i])}¬∞<br>${ic}</div>`;
  }
  document.getElementById('forecast').innerHTML=html;

  // CANVAS ANIMATIONS
  const canvas=document.getElementById('weatherCanvas');
  const ctx=canvas.getContext('2d');
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;

  // simple animation selon m√©t√©o
  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(theme==='sunny'){
      // soleil simple
      ctx.fillStyle='rgba(255,223,0,0.4)';
      ctx.beginPath();
      ctx.arc(canvas.width-80,80,50,0,Math.PI*2);
      ctx.fill();
    } else if(theme==='rainy'){
      // pluie simple
      ctx.strokeStyle='rgba(173,216,230,0.6)';
      for(let i=0;i<100;i++){
        ctx.beginPath();
        ctx.moveTo(Math.random()*canvas.width, Math.random()*canvas.height);
        ctx.lineTo(Math.random()*canvas.width, Math.random()*canvas.height+10);
        ctx.stroke();
      }
    } else if(theme==='snowy'){
      // neige simple
      ctx.fillStyle='rgba(255,255,255,0.7)';
      for(let i=0;i<100;i++){
        ctx.beginPath();
        ctx.arc(Math.random()*canvas.width, Math.random()*canvas.height,2,0,Math.PI*2);
        ctx.fill();
      }
    }
    requestAnimationFrame(animate);
  }
  animate();
});

// SERVICE WORKER
if('serviceWorker' in navigator){navigator.serviceWorker.register('service-worker.js');}
</script>
</body>
</html>
