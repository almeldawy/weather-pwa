<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weather Premium</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Manifest PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#38bdf8">
<link rel="icon" type="image/png" href="icons/icon-192.png">

<style>
/* üåà VARIABLES & THEMES */
:root {
  --bg: linear-gradient(135deg, #bae6fd, #ffffff);
  --card: rgba(255,255,255,0.25);
  --text: #0f172a;
  --accent: #fbbf24;
}
body.dark {
  --bg: linear-gradient(135deg, #0f172a, #020617);
  --card: rgba(15,23,42,0.4);
  --text: #f8fafc;
  --accent: #facc15;
}
body.sunny { --bg: linear-gradient(135deg,#fde68a,#fef3c7); }
body.rainy { --bg: linear-gradient(135deg,#94a3b8,#e2e8f0); }
body.snowy { --bg: linear-gradient(135deg,#e0f2fe,#f8fafc); }
body.cloudy { --bg: linear-gradient(135deg,#cbd5e1,#f1f5f9); }

/* GLOBAL STYLES */
* { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
body { margin:0; min-height:100vh; background: var(--bg); color: var(--text);
      display:flex; justify-content:center; align-items:center; transition: background 0.8s;}
.app { width:100%; max-width:440px; padding:20px; }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
button { border:none; background: var(--card); backdrop-filter:blur(12px);
         border-radius:14px; padding:10px 14px; font-size:18px; cursor:pointer; transition: transform 0.2s; }
button:hover { transform: scale(1.05); }
.card { padding:30px; border-radius:28px; background: var(--card); backdrop-filter: blur(18px);
        box-shadow:0 20px 50px rgba(0,0,0,0.15); text-align:center; transition: all 0.5s;}
.temp { font-size:70px; font-weight:700; margin:10px 0; }
.icon { font-size:60px; animation: float 3s ease-in-out infinite; }
@keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
.forecast { display:flex; justify-content:space-between; margin-top:20px; font-size:14px; overflow-x:auto; padding-bottom:10px; }
.forecast div { background: rgba(255,255,255,0.1); padding:8px 12px; border-radius:12px; margin-right:8px; min-width:55px; text-align:center; }
.daily { margin-top:20px; text-align:center; font-size:14px; display:flex; flex-direction:column; }
.daily div { margin-bottom:6px; display:flex; justify-content:space-between; padding:6px 12px; border-radius:12px; background: rgba(255,255,255,0.15);}
.daily div span { font-weight:600; }
::-webkit-scrollbar { height:6px; }
::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius:3px; }
</style>
</head>

<body>
<main class="app">
<header>
  <h1 id="city">Localisation‚Ä¶</h1>
  <button id="theme">üåô</button>
</header>

<section class="card">
  <div class="icon" id="icon">‚õÖ</div>
  <div class="temp"><span id="temp">--</span>¬∞C</div>
  <p id="desc">---</p>

  <div class="forecast" id="forecast"></div>
  <div class="daily" id="daily"></div>
</section>
</main>

<script>
// THEME
if(localStorage.theme==='dark') document.body.classList.add('dark');
document.getElementById('theme').onclick = ()=>{
  document.body.classList.toggle('dark');
  localStorage.theme=document.body.classList.contains('dark')?'dark':'light';
};

// WEATHER CODES
const codes={
  0:["‚òÄÔ∏è","Ciel d√©gag√©","sunny"],
  1:["üå§Ô∏è","Peu nuageux","sunny"],
  2:["‚õÖ","Nuages","cloudy"],
  3:["‚òÅÔ∏è","Couvert","cloudy"],
  45:["üå´Ô∏è","Brouillard","cloudy"],
  48:["üå´Ô∏è‚ùÑÔ∏è","Brouillard givrant","snowy"],
  51:["üå¶Ô∏è","Bruine","rainy"],
  61:["üåßÔ∏è","Pluie","rainy"],
  63:["üåßÔ∏è","Pluie mod√©r√©e","rainy"],
  65:["üåßÔ∏èüíß","Pluie forte","rainy"],
  71:["‚ùÑÔ∏è","Neige","snowy"],
  73:["‚ùÑÔ∏è","Neige mod√©r√©e","snowy"],
  75:["‚ùÑÔ∏èüíß","Neige forte","snowy"],
  80:["üå¶Ô∏è","Averses","rainy"],
  81:["üåßÔ∏è","Averses mod√©r√©es","rainy"],
  82:["üåßÔ∏èüíß","Averses fortes","rainy"],
  95:["‚õàÔ∏è","Orage","rainy"]
};

// GEO + WEATHER
navigator.geolocation.getCurrentPosition(async pos=>{
  const {latitude,longitude}=pos.coords;

  // CITY via OpenStreetMap
  const geo=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`).then(r=>r.json());
  document.getElementById('city').textContent=geo.address.city||geo.address.town||geo.address.village||"Votre position";

  // CURRENT + HOURLY + DAILY WEATHER
  const data=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&hourly=temperature_2m&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`).then(r=>r.json());

  // CURRENT
  const w=data.current_weather;
  const [icon,text,theme]=codes[w.weathercode]||["‚ùî","Inconnu","cloudy"];
  document.getElementById('icon').textContent=icon;
  document.getElementById('temp').textContent=Math.round(w.temperature);
  document.getElementById('desc').textContent=text;
  document.body.classList.add(theme);

  // HOURLY FORECAST 3H
  const hours=data.hourly.temperature_2m.slice(1,4);
  document.getElementById('forecast').innerHTML=hours.map((t,i)=>`<div>+${(i+1)*3}h<br>${Math.round(t)}¬∞</div>`).join("");

  // DAILY FORECAST 7 DAYS
  const days=data.daily.weathercode.slice(0,7);
  const maxs=data.daily.temperature_2m_max.slice(0,7);
  const mins=data.daily.temperature_2m_min.slice(0,7);
  document.getElementById('daily').innerHTML=days.map((c,i)=>{
    const [ic,desc]=codes[c]||["‚ùî","Inconnu"];
    return `<div><span>${ic} ${desc}</span> <span>${Math.round(maxs[i])}¬∞/${Math.round(mins[i])}¬∞</span></div>`;
  }).join("");
});

// SERVICE WORKER
if('serviceWorker' in navigator){navigator.serviceWorker.register('service-worker.js');}
</script>
</body>
</html>

